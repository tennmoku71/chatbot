# Git を使った共同開発のやりかた

バージョン管理システム Git とそれを使ったオンラインサービス GitHub を使って共同開発を始めるための手順を説明します

## 【Git を使い始める時に最初に１回だけやること】
Windows の場合は、スタートメニューから Git bash を起動して、そこで下記のコマンドを入力してください。Macの場合はターミナルで実施してください。"ユーザ名"　のところは、メールアドレスと合わせて表示される自分の名前を英語名で書いてください。"メールアドレス" は公開してもかまわないアドレスを入れてください。

```sh
$ git config --global user.name "ユーザ名"
$ git config --global user.email "メールアドレス"
```

続いて、git でコミットログを書く時のエディタを指定します。Visual Studio Code の場合は "code" としてください。

```
$ git config --global core.editor "code"
```
## 【GitHub を使い始めるときに最初に１回だけやること】
まだ GitHub のアカウントを持っていない方は、GitHub のサイトを開いてユーザー登録します。ユーザー名とメールアドレスとパスワードを聞かれますので、入力するときに忘れないようにメモしておいてください。

    https://github.com/

### SSH 公開鍵の登録（オプション）
GitHub を利用するときに、毎回パスワードを聞かれると手間がかかるので、パスワードを使わなくても安全に GitHub を利用できるようにするために、セキュアーシェルの秘密鍵と公開鍵を作成します。

Windows の場合は、スタートメニューから Git bash を起動して、そこで下記のコマンドを入力してください。Macの場合はターミナルで実施してください。
```sh
$ ssh-keygen
```
このコマンドを入力すると、対話的に新しいパスワードを入力するように聞かれますが、入力はせず Enter で進めてください。
これが終わると、ホームディレクトリの下の、`~/.ssh` というディレクトリに秘密鍵 `id_rsa` と公開鍵 `id_rsa.pub` のファイルができています。
```sh
$ ls ~/.ssh/
config  id_rsa  id_rsa.pub  known_hosts
```

`id_rsa.pub` を GitHub に登録します。そのためには、再び、GitHub ホームページ

    https://github.com/

を開いて、右上のあなたのアイコンをクリックし、開いたメニューの下の方にある、Settings という項目を選びます。画面の左に、Personal Settings というメニューが表示されるので、その中の、SSH and GPG keys というところをクリックします。右上のほうに New SSH key という緑色のボタンがあるので、それをクリックします。Title と Key という２つの欄が現れるので、Title は、今使っているパソコンと関係あるキーワードを書いてください。仕事で使っているマシンなら、Work PC とか。
Key のところは、 公開鍵 id_rsa.pub の内容をコピーして貼り付けてください。Add SSH key ボタンを押したら、完了です。

これで、パスワードを聞かれることなく git コマンドで GitHub に書き込むことができるようになりました。


## 【Git の使い方（1人で使う場合）】
Windows の場合は、スタートメニューから Git bash を起動して、そこで下記のコマンドを入力してください。Macの場合はターミナルで実施してください。

### 1. 開発用のディレクトリに移動します。

```sh
$ cd Desktop/pyworks
```

### 2. Git コマンドで chatbot プロジェクトのソースコードをクローン（ダウンロード）します。

今回は開発用のディレクトリ chatbot-dev にダウンロードすることにします。

```sh
$ git clone https://github.com/HideKobayashi/chatbot.git chatbot-dev
```

これで、chatbot-dev というディレクトリ（フォルダ）ができます。
chatbot-dev ディレクトリに移動します。

```sh
$ cd chatbot-dev
```
このディレクトリは、Git でクローンして作られたので Git で管理されているディレクトリになります。Git で管理されるディレクトリの下には`.git` というディレクトリがあります。これをローカルリポジトリと呼びます。


### 3. ローカルリポジトリの状態を知る
ローカルリポジトリの状態を表示するには、`git status` を使います。
```sh
$ git status
```
特に異常がない場合は
```
On branch master
Your branch is up to date with 'origin/develop'.

nothing to commit, working tree clean
```
などと表示されます。

ローカルリポジトリのブランチを表示するには、`git branch` を使います。
```sh
$ git branch
```
今の場合は、
```
* master
```
と表示されるはずです。master ブランチで作業していることを示しています。

ローカルリポジトリの履歴を表示するには、`git log` を使います。
```sh
$ git log
```
履歴表示は上に行くほど新しいです。
履歴が長いときは、ページがスクロールして流れてしまわないように less が起動されていますので、スペースキーで次のページを表示、b キーで前のページに戻る、q キーで表示をやめることができます。

ローカルリポジトリの履歴を表示する `git log` の面白い機能として、グラフ表示も紹介します。
```sh
$ git log --graph --oneline
```
ブランチが分岐したりマージされる様子がグラフで表示されます。


### 3. ブランチ origin/develop をリモートからチェックアウト（ダウンロード）します。
まず、リモートディレクトリにどんなブランチがあるか表示します。
```sh
$ git branch -a
```
リモートブランチに、master のほかに develop もあるはずです。

リモートブランチの develop をローカルにダウンロードしそこで作業することにします。
```sh
$ git checkout -b  develop origin/develop
```
ブランチを表示します。
```sh
$ git branch
```
表示は下記のようになるはずです。
```
* develop
  master
```
これで、開発用のブランチ（ソフトウエアのセット）がダウンロードできました。

このブランチは、

    1. 画面部分を form.html というファイルに分離してある。
    2. エンターキーで「発言」ボタンを押したのと同じことができる。

などが追加してあります。

develop ブランチは後で使用します。


### 4. ブランチ master を元に、新しいブランチを作成します。
新しいブランチを作成する前に、基準となるブランチに移ります。
master ブランチをチェックアウトします。
```sh
$ git checkout master
```

次に、このブランチから分岐して、新しいブランチを作成します。
ブランチの名前は、用途に応じたものにするか、あなたのニックネームにするとよいでしょう。
たとえば、改造のテーマが天気予報であれば、weather 日付時刻応答であれば、timereport 占い機能追加であれば fortune です。

ここでは、占いの機能を追加したソースコードを開発するとして、fortune という名前のブランチを作成します。

```sh
$ git branch fortune
```

ブランチが作成されたか確認するには、次のようにします。
```sh
$ git branch
```
作成したブランチに移って作業するには、ブランチをチェックアウトします。

```sh
$ git checkout fortune
```
今いるブランチがどれなのかを知るには、次のようにします。
```sh
$ git branch
```
今いるブランチ名の先頭に `*` がついています。

これで開発の準備が整いました。次はソースコードを編集します。


### 5. ソースコードを編集します。

さて、ここからがあなたの独自の開発を行うところです。

まず、ソースコードを編集する前に、バージョン管理の状態がどうなっているか見てみます。それには、次のようにします。

```sh
$ git status
```

次に、ソースコードを編集しましょう。すでに、別のディレクトリに編集済みのソースコードがある場合は、それをこのディレクトリにコピーしてきます。

ここでは、`../chatbot/` というディレクトリに編集済みのソースコードがあるとして、以下の４つのファイルをこのディレクトリにコピーします。

    ../chatbot/cgi-bin/botengine.py
    ../chatbot/cgi-bin/chatbot.py
    ../chatbot/cgi-bin/fortune.py
    ../chatbot/chatbot-data.json

下記のコマンドを実行してください。
```sh
$ cp ../chatbot/cgi-bin/*.py cgi-bin/
$ cp ../chatbot/chatbot-data.json 
```
続いて、git の状態をみてみます。

```sh
$ git status
```
４つのファイルが変更されたことが示されています。変更内容を見るには、次のようにします。

```sh
$ git diff
```

変更された内容が示されます。スペースキーでページを送ります。q キーで表示を抜けます。

### 6. 変更内容を登録する候補を準備します。
変更の登録は、複数のファイルを同時に行うことができますので、登録候補を `git add` コマンドでステージング（準備）します。
```sh
$ git add cgi-bin/*.py chatbot-data.json
```
ステージングの状態がどうなったか、`git status` で確認します。
```sh
$ git status
```

### 7. 変更内容を登録します。
これらを登録（コミット）するには、つぎのようにします。
```sh
$ git commit -m "占い機能追加。画面をくれりん仕様に変更。より乙女チックに。"
```
変更がと黒くされたか確認するには、`git log` を見ます。
```sh
$ git log
```

### 8. ローカルブランチをリモートレポジトリに追加します。
占い機能を追加したローカルブランチ fortune を、共同作業者に見てもらうため、リモートレポジトリに書き込み（プッシュ）します。
```sh
$ git push origin fortune
```
リモートブランチに書き込まれたかを確認するには、`git branch -a` を使います。
```sh
$ git branch -a
```
リスト`remotes/origin/fortune` がに現れていれば成功です。
GitHubの Web ページでも確認しましょう。chatbot のページ

    https://github.com/HideKobayashi/chatbot

を開いて、

## 【Git コマンドのまとめ】
### 状態を見るためのコマンド
ソースコードの状態を見る。
```sh
$ git status
```
ローカルのブランチの一覧を見る
```sh
$ git branch
```
リモート（GitHub）のブランチの一覧を見る。
```sh
$ git branch -r
```
変更の履歴を見る。
```sh
$ git log
```
変更の履歴をグラフ化して見る。
```sh
$ git log --graph --oneline
```
変更した行を表示する
```sh
$ git diff
```
form.html の変更した行を表示する。
```sh
$ git diff form.html
```

### 5. 必要に応じて、下記のコマンドで変更を登録します。

変更を登録する準備（ステージ）する form.html の場合。
```sh
$ git add form.html
```
変更を登録（コミット）する。
```sh
$ git commit -m "変更点をわかりやすい文章で記入"
```

## 【複数人で共同開発する場合】

### 1

### 2

### 3

